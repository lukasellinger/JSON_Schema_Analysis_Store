{
  "id": "https://schema.management.azure.com/schemas/2016-03-01/Microsoft.ServiceFabric.json#",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Microsoft.ServiceFabric",
  "description": "Microsoft ServiceFabric Resource Types",
  "resourceDefinitions": {
    "clusters": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "Microsoft.ServiceFabric/clusters"
          ]
        },
        "apiVersion": {
          "type": "string",
          "enum": [
            "2016-03-01"
          ]
        },
        "properties": {
          "oneOf": [
            {
              "$ref": "#/definitions/ClusterProperties"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Gets or sets the cluster properties."
        }
      },
      "required": [
        "type",
        "apiVersion",
        "properties"
      ],
      "description": "Microsoft.ServiceFabric/clusters: ServiceFabric cluster resource."
    }
  },
  "definitions": {
    "CertificateDescription": {
      "type": "object",
      "properties": {
        "thumbprint": {
          "type": "string",
          "minLength": 1
        },
        "thumbprintSecondary": {
          "type": "string"
        },
        "x509StoreName": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "AddressBook",
                "AuthRoot",
                "CertificateAuthority",
                "Disallowed",
                "My",
                "Root",
                "TrustedPeople",
                "TrustedPublisher"
              ]
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        }
      },
      "required": [
        "thumbprint",
        "x509StoreName"
      ]
    },
    "AzureActiveDirectory": {
      "type": "object",
      "properties": {
        "tenantId": {
          "type": "string",
          "minLength": 1
        },
        "clusterApplication": {
          "type": "string",
          "minLength": 1
        },
        "clientApplication": {
          "type": "string",
          "minLength": 1
        }
      },
      "required": [
        "tenantId",
        "clusterApplication",
        "clientApplication"
      ]
    },
    "NodeTypes": {
      "type": "object",
      "properties": {
        "httpApplicationGatewayEndpointPort": {
          "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
        },
        "durabilityLevel": {
          "oneOf": [
            {
              "$ref": "#/definitions/Level"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "This level is used to set the durability of nodes of this type."
        },
        "vmInstanceCount": {
          "oneOf": [
            {
              "type": "integer",
              "minimum": 1,
              "maximum": 2147483647
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "placementProperties": {
          "oneOf": [
            {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        },
        "capacities": {
          "oneOf": [
            {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        },
        "clientConnectionEndpointPort": {
          "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
        },
        "httpGatewayEndpointPort": {
          "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
        },
        "applicationPorts": {
          "oneOf": [
            {
              "$ref": "#/definitions/Ports"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        },
        "ephemeralPorts": {
          "oneOf": [
            {
              "$ref": "#/definitions/Ports"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        },
        "isPrimary": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        }
      },
      "required": [
        "vmInstanceCount",
        "name",
        "clientConnectionEndpointPort",
        "httpGatewayEndpointPort",
        "isPrimary"
      ]
    },
    "Ports": {
      "type": "object",
      "properties": {
        "startPort": {
          "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
        },
        "endPort": {
          "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
        }
      },
      "required": [
        "startPort",
        "endPort"
      ]
    },
    "Level": {
      "type": "string",
      "enum": [
        "Bronze",
        "Silver",
        "Gold",
        "Platinum"
      ]
    },
    "ClientCertificateThumbprint": {
      "type": "object",
      "properties": {
        "isAdmin": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        },
        "certificateThumbprint": {
          "type": "string",
          "minLength": 1
        }
      },
      "required": [
        "isAdmin",
        "certificateThumbprint"
      ]
    },
    "ClientCertificateCommonName": {
      "type": "object",
      "properties": {
        "isAdmin": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ]
        },
        "certificateCommonName": {
          "type": "string",
          "minLength": 1
        },
        "certificateIssuerThumbprint": {
          "type": "string",
          "minLength": 1
        }
      },
      "required": [
        "isAdmin",
        "certificateCommonName",
        "certificateIssuerThumbprint"
      ]
    },
    "SettingsSectionDescription": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "parameters": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1
                  },
                  "value": {
                    "type": "string"
                  }
                },
                "required": [
                  "name",
                  "value"
                ]
              },
              {
                "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
              }
            ]
          }
        }
      },
      "required": [
        "name",
        "parameters"
      ]
    },
    "PaasClusterUpgradePolicy": {
      "type": "object",
      "properties": {
        "upgradeReplicaSetCheckTimeout": {
          "type": "string"
        },
        "healthCheckWaitDuration": {
          "type": "string"
        },
        "healthCheckStableDuration": {
          "type": "string"
        },
        "healthCheckRetryTimeout": {
          "type": "string"
        },
        "upgradeTimeout": {
          "type": "string"
        },
        "upgradeDomainTimeout": {
          "type": "string"
        },
        "healthPolicy": {
          "type": "object",
          "properties": {
            "maxPercentUnhealthyNodes": {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
            },
            "maxPercentUnhealthyApplications": {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
            }
          },
          "required": [
            "maxPercentUnhealthyNodes",
            "maxPercentUnhealthyApplications"
          ]
        },
        "deltaHealthPolicy": {
          "type": "object",
          "properties": {
            "maxPercentDeltaUnhealthyNodes": {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
            },
            "maxPercentUpgradeDomainDeltaUnhealthyNodes": {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
            },
            "maxPercentDeltaUnhealthyApplications": {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_numberOrExpression"
            }
          },
          "required": [
            "maxPercentDeltaUnhealthyNodes",
            "maxPercentUpgradeDomainDeltaUnhealthyNodes",
            "maxPercentDeltaUnhealthyApplications"
          ]
        }
      },
      "required": [
        "upgradeReplicaSetCheckTimeout",
        "healthCheckWaitDuration",
        "healthCheckStableDuration",
        "healthCheckRetryTimeout",
        "upgradeTimeout",
        "upgradeDomainTimeout",
        "healthPolicy"
      ]
    },
    "DiagnosticsStorageAccountConfig": {
      "type": "object",
      "properties": {
        "storageAccountName": {
          "type": "string",
          "minLength": 1
        },
        "protectedAccountKeyName": {
          "type": "string"
        },
        "blobEndpoint": {
          "type": "string"
        },
        "queueEndpoint": {
          "type": "string"
        },
        "tableEndpoint": {
          "type": "string"
        }
      },
      "required": [
        "storageAccountName",
        "protectedAccountKeyName",
        "blobEndpoint",
        "queueEndpoint",
        "tableEndpoint"
      ]
    },
    "ClusterProperties": {
      "type": "object",
      "properties": {
        "vmImage": {
          "type": "string",
          "description": "Microsoft.ServiceFabric/clusters: The name of VM image VMSS has been configured with. Generic names such as Windows or Linux can be used."
        },
        "httpApplicationGatewayCertificate": {
          "oneOf": [
            {
              "$ref": "#/definitions/CertificateDescription"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: The server certificate used by reverse proxy."
        },
        "azureActiveDirectory": {
          "oneOf": [
            {
              "$ref": "#/definitions/AzureActiveDirectory"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: The settings to enable AAD authentication on the cluster."
        },
        "reliabilityLevel": {
          "oneOf": [
            {
              "$ref": "#/definitions/Level"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: This level is used to set the number of replicas of the system services. Details: http://azure.microsoft.com/en-us/documentation/articles/service-fabric-cluster-capacity/#the-reliability-characteristics-of-the-cluster"
        },
        "nodeTypes": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/NodeTypes"
              },
              "minItems": 1
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: The node types of the cluster. Details: http://azure.microsoft.com/en-us/documentation/articles/service-fabric-cluster-capacity"
        },
        "managementEndpoint": {
          "type": "string",
          "minLength": 1,
          "description": "Microsoft.ServiceFabric/clusters: The http management endpoint of the cluster."
        },
        "certificate": {
          "oneOf": [
            {
              "$ref": "#/definitions/CertificateDescription"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: The certificate to use for node to node communication within cluster, the server certificate of the cluster and the default admin client."
        },
        "clientCertificateThumbprints": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/ClientCertificateThumbprint"
              }
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: List of client certificates to whitelist based on thumbprints."
        },
        "clientCertificateCommonNames": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/ClientCertificateCommonName"
              }
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: List of client certificates to whitelist based on common names."
        },
        "fabricSettings": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/SettingsSectionDescription"
              }
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: List of custom fabric settings to configure the cluster."
        },
        "upgradeDescription": {
          "oneOf": [
            {
              "$ref": "#/definitions/PaasClusterUpgradePolicy"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: The policy to use when upgrading the cluster."
        },
        "diagnosticsStorageAccountConfig": {
          "oneOf": [
            {
              "$ref": "#/definitions/DiagnosticsStorageAccountConfig"
            },
            {
              "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
            }
          ],
          "description": "Microsoft.ServiceFabric/clusters: The azure storage account information for uploading cluster logs."
        }
      },
      "required": [
        "nodeTypes",
        "managementEndpoint"
      ]
    },
    "..\\common\\definitions.json_definitions_expression": {
      "type": "string",
      "pattern": "^\\[([^\\[].*)?\\]$",
      "description": "Deployment template expression. See https://aka.ms/arm-template-expressions for more details on the ARM expression syntax."
    },
    "..\\common\\definitions.json_definitions_numberOrExpression": {
      "oneOf": [
        {
          "type": "number"
        },
        {
          "$ref": "#/definitions/..\\common\\definitions.json_definitions_expression"
        }
      ]
    }
  }
}